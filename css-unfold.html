<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Sass/Stylus Class Unfolder</title>
    <style>
        :root { --primary: #4f46e5; --bg: #f1f5f9; }
        body { font-family: 'Fira Code', monospace; background: var(--bg); padding: 40px; }
        .container { max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .panel { background: white; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); display: flex; flex-direction: column; overflow: hidden; }
        .header { padding: 12px; background: #fce7f3; font-weight: bold; color: #be185d; border-bottom: 1px solid #fbcfe8; }
        textarea { height: 500px; border: none; padding: 20px; font-size: 14px; line-height: 1.6; outline: none; resize: none; }
        #output { background: #fafafa; color: #333; }
        .hint { grid-column: 1 / -1; background: #fff; padding: 15px; border-radius: 8px; font-size: 13px; color: #666; border-left: 5px solid var(--primary); }
        .nav-back { margin-bottom: 20px; display: inline-block; text-decoration: none; color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <a href="index.html" class="nav-back">â† è¿”å›é¦–é </a>
    <div class="hint">
        <strong>ğŸ’¡ é‡æ§‹ç›®æ¨™ï¼š</strong> å°‡å·¢ç‹€çš„ <code>&amp;</code> èªæ³•å±•é–‹ç‚ºå®Œæ•´çš„ Class åç¨±ï¼Œæå‡å°ˆæ¡ˆå…¨å±€æœå°‹çš„ä¾¿åˆ©æ€§ã€‚
    </div>

    <div class="panel">
        <div class="header">Sass / Stylus (Input)</div>
        <textarea id="input" placeholder=".nav
  padding: 10px
  &-btn
    color: red
    &-icon
      width: 16px"></textarea>
    </div>

    <div class="panel">
        <div class="header">Refactored (Output)</div>
        <textarea id="output" readonly></textarea>
    </div>
</div>

<script>
    const input = document.getElementById('input');
    const output = document.getElementById('output');

    input.addEventListener('input', () => {
        const lines = input.value.split('\n');
        let result = [];
        let stack = []; // å„²å­˜æ¯ä¸€å±¤çš„å®Œæ•´é¸æ“‡å™¨åç¨±

        lines.forEach(line => {
            const trimmed = line.trim();
            if (!trimmed) {
                result.push("");
                return;
            }

            // 1. è‡ªå‹•åµæ¸¬ç¸®æ’æ·±åº¦ (ç›¸å°æ–¼å‰ä¸€è¡Œçš„ç©ºç™½æ•¸)
            const indentMatch = line.match(/^\s*/);
            const currentIndent = indentMatch ? indentMatch[0].length : 0;
            
            // å°‹æ‰¾ç•¶å‰æ·±åº¦åœ¨ stack ä¸­çš„ä½ç½® (æ”¯æ´ 2 ç©ºæ ¼æˆ– 4 ç©ºæ ¼ç­‰ä¸åŒç¿’æ…£)
            // æˆ‘å€‘æ ¹æ“šç•¶å‰ç©ºç™½é•·åº¦ä¾†åˆ¤æ–·å±¤ç´š
            let depth = 0;
            if (currentIndent > 0) {
                // æ‰¾å‡ºæ¯”ç•¶å‰ç¸®æ’å°çš„å±¤ç´šæ•¸é‡
                depth = stack.filter(s => s && s.indent < currentIndent).length;
            }

            // å¦‚æœç¸®æ’å›ç¸®ï¼Œæ¸…æ‰ stack è£¡é¢æ¯”ç•¶å‰ç¸®æ’æ·±çš„å±¤ç´š
            stack = stack.filter(s => s && s.indent < currentIndent);

            // 2. åˆ¤æ–·æ˜¯ã€Œé¸æ“‡å™¨ã€é‚„æ˜¯ã€Œå±¬æ€§ã€
            // æ“´å¤§åˆ¤æ–·ï¼šåŒ…å« &ã€ä»¥ . æˆ– # é–‹é ­ã€æˆ–åŒ…å«å†’è™Ÿä¸”æ²’ç©ºæ ¼(æ¨™ç±¤é¸æ“‡å™¨)
            const isSelector = trimmed.includes('&') || 
                            trimmed.startsWith('.') || 
                            trimmed.startsWith('#') || 
                            (trimmed.match(/^[a-zA-Z0-9_-]+$/)); // ç°¡å–®çš„æ¨™ç±¤å¦‚ div, li

            if (isSelector && !trimmed.includes(': ')) {
                // è™•ç† Selector
                let parentSelector = stack.length > 0 ? stack[stack.length - 1].full : "";
                let currentFullSelector = "";

                if (trimmed.includes('&')) {
                    // é‡é»ä¿®æ­£ï¼šä½¿ç”¨æ­£å‰‡è¡¨é”å¼ /&/g é€²è¡Œå…¨åŸŸæ›¿æ›ï¼Œè™•ç†å¤šå€‹ & çš„æƒ…æ³
                    currentFullSelector = trimmed.replace(/&/g, parentSelector).trim();
                } else {
                    // å¦‚æœæ²’æœ‰ &ï¼Œä½†å®ƒæ˜¯å·¢ç‹€çš„ï¼Œé€šå¸¸ä»£è¡¨å¾Œä»£é¸æ“‡å™¨ (ä¾‹å¦‚ .nav å…§å±¤å¯« li)
                    currentFullSelector = parentSelector ? `${parentSelector} ${trimmed}` : trimmed;
                }

                stack.push({ indent: currentIndent, full: currentFullSelector });
                result.push(currentFullSelector);
            } else {
                // è™•ç†å±¬æ€§ (å¦‚ padding: 10px)
                result.push("  " + trimmed);
            }
        });

        output.value = result.join('\n');
    });

    // åˆå§‹è§¸ç™¼ä¸€æ¬¡
    input.dispatchEvent(new Event('input'));
</script>
</body>
</html>